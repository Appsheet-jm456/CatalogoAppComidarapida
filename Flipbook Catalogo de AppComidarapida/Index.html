<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Flipbook — Kinetic English</title>
  <meta name="description" content="Flipbook ligero con efecto de paso de página. Un solo archivo HTML, sin librerías." />
  <style>
    :root{
      /* Se calcula dinámicamente en JS tras precargar imágenes */
      --page-ratio: 1.414; /* alto/ancho de una página individual, valor inicial */
      --book-max-w: 1200px;
      --book-pad: 12px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;
      background:#0f172a; color:#e2e8f0; display:flex; flex-direction:column; align-items:center; gap:10px;
    }
    header{padding:8px 12px; width:min(100%, var(--book-max-w)); display:flex; gap:8px; align-items:center; justify-content:space-between}
    header h1{font-size:16px; margin:0; font-weight:600; color:#cbd5e1}
    header .controls{display:flex; gap:8px; align-items:center}
    button, .btn{appearance:none; border:1px solid #334155; background:#111827; color:#e5e7eb; padding:8px 10px; border-radius:10px; cursor:pointer}
    button:disabled{opacity:.5; cursor:not-allowed}
    .counter{font-variant-numeric:tabular-nums}

    /* Contenedor del libro: 2 páginas visibles (izq/der) */
    .stage{position:relative; width:min(92vw, var(--book-max-w)); aspect-ratio: 2 / var(--page-ratio); /* ancho:alto del libro = 2:ratio */
      max-height:82vh; margin:auto;}
    .book{position:relative; width:100%; height:100%; perspective:2000px; background:#0b1220; border-radius:16px; box-shadow:0 20px 60px rgba(0,0,0,.45), inset 0 0 0 1px #1f2937}

    /* Tap zones (clic/touch) */
    .tap{position:absolute; top:0; bottom:0; width:28%; z-index:50}
    .tap.left{left:0}
    .tap.right{right:0}

    /* Lomo central visual */
    .spine{position:absolute; top:0; bottom:0; left:50%; width:2px; background:linear-gradient(180deg, #0b1220, #1f2937 40%, #1f2937 60%, #0b1220); z-index:1;}

    /* Hojas (sheets) apiladas en el lado derecho que se voltean hacia la izquierda) */
    .sheet{position:absolute; top:var(--book-pad); bottom:var(--book-pad); left:50%; width:calc(50% - var(--book-pad));
      transform-origin:left center; transform-style:preserve-3d; transition:transform .8s ease, box-shadow .8s ease; border-radius:12px;}
    .sheet:not(.flipped){box-shadow: -6px 8px 24px rgba(0,0,0,.35)}
    .sheet.flipped{transform:rotateY(-180deg); z-index:2}

    /* Caras de cada hoja */
    .face{position:absolute; inset:0; backface-visibility:hidden; overflow:hidden; border-radius:12px; background:#0c1220;}
    .face img{position:absolute; inset:0; margin:auto; max-width:100%; max-height:100%; width:100%; height:100%; object-fit:contain; image-rendering:auto}
    .face.front{ /* Página impar (derecha) */
      background:linear-gradient(90deg, rgba(255,255,255,.04), rgba(255,255,255,.01));
      border-left:1px solid #1f2937;
    }
    .face.back{ /* Página par (izquierda, cuando la hoja está volteada) */
      transform:rotateY(180deg);
      background:linear-gradient(270deg, rgba(255,255,255,.04), rgba(255,255,255,.01));
      border-right:1px solid #1f2937;
    }

    /* Páginas de fondo para el estado inicial (cubierta izquierda vacía) */
    .left-static,.right-static{position:absolute; top:var(--book-pad); bottom:var(--book-pad); width:calc(50% - var(--book-pad)); border-radius:12px; overflow:hidden;}
    .left-static{left:var(--book-pad); background:#0c1220; border-right:1px solid #1f2937}
    .right-static{right:var(--book-pad); background:#0c1220; border-left:1px solid #1f2937}

    /* Sombras dinámicas durante el volteo */
    .sheet::before{content:""; position:absolute; inset:0; pointer-events:none; transition:opacity .8s ease; opacity:.0;
      background:radial-gradient(120% 100% at 0% 50%, rgba(0,0,0,.35), transparent 60%)}
    .sheet:not(.flipped).hover::before{opacity:.25}
    .sheet.flipped::before{opacity:.1}

    /* Barra inferior */
    footer{width:min(100%, var(--book-max-w)); display:flex; align-items:center; gap:12px; padding:10px 12px; justify-content:space-between}
    .slider{flex:1}
    input[type="range"]{width:100%}

    /* Ayudas */
    .hint{font-size:12px; color:#94a3b8}
    .hidden{display:none}
  </style>
</head>
<body>
  <header>
    <h1>Flipbook — un solo HTML</h1>
    <div class="controls">
      <button id="prev" aria-label="Página anterior">⟵</button>
      <span class="counter"><span id="current">1</span>/<span id="total">1</span></span>
      <button id="next" aria-label="Página siguiente">⟶</button>
    </div>
  </header>

  <div class="stage">
    <div class="book" id="book">
      <div class="left-static" id="leftStatic"></div>
      <div class="right-static" id="rightStatic"></div>
      <div class="spine"></div>
      <div class="tap left" id="tapLeft" aria-hidden="true"></div>
      <div class="tap right" id="tapRight" aria-hidden="true"></div>
    </div>
  </div>

  <footer>
    <div class="hint">Clic/tap a los lados, o usa ← →. Arrastra para pasar página en móviles.</div>
    <div class="slider"><input id="range" type="range" min="1" max="1" value="1" /></div>
  </footer>

  <script>
  /* =============================
     CONFIGURACIÓN DEL USUARIO
     - Coloca tus PNG/JPG en /pages
     - Enumera en orden de lectura.
     - Pueden tener tamaños distintos. El sistema adapta.
  ============================== */
  const IMAGES = [
    'pages/01.png',
    'pages/02.png',
    'pages/03.png',
    'pages/04.png',
    'pages/05.png',
    'pages/06.png',
    'pages/07.png',
    'pages/08.png'
  ];

  /* =============================
     LÓGICA DEL FLIPBOOK
  ============================== */
  const book = document.getElementById('book');
  const btnPrev = document.getElementById('prev');
  const btnNext = document.getElementById('next');
  const tapLeft = document.getElementById('tapLeft');
  const tapRight = document.getElementById('tapRight');
  const range = document.getElementById('range');
  const currentEl = document.getElementById('current');
  const totalEl = document.getElementById('total');

  let sheets = [];            // cada hoja tiene dos caras: front (p impar), back (p par)
  let currentPage = 1;        // página visible (1..N)
  const N = IMAGES.length;
  totalEl.textContent = String(N);
  range.max = String(N);

  // Precarga imágenes para calcular proporciones
  Promise.all(IMAGES.map(src => new Promise(res => { const im=new Image(); im.onload=()=>res({w:im.naturalWidth,h:im.naturalHeight}); im.onerror=()=>res({w:1000,h:1414}); im.src=src; })))
  .then(dimensions => {
    // Ratio máximo (alto/ancho) de cualquier página para dimensionar el libro
    const ratios = dimensions.map(d => d.h / Math.max(1,d.w));
    const maxRatio = Math.max(...ratios);
    document.documentElement.style.setProperty('--page-ratio', maxRatio.toFixed(4));
    buildSheets();
    // Navega a #p= si viene en URL
    const p = Number(new URLSearchParams(location.hash.replace('#','?')).get('p'));
    if (p>=1 && p<=N) goTo(p, {instant:true});
    else updateUI();
  });

  function buildSheets(){
    // Limpia anteriores (si recargamos)
    for (const el of Array.from(book.querySelectorAll('.sheet'))) el.remove();
    sheets = [];

    const countSheets = Math.ceil(N/2);
    for (let s=0; s<countSheets; s++){
      const pageR = (s*2)+1;       // impar (derecha)
      const pageL = pageR+1;       // par (izquierda)
      const z = (countSheets - s) + 2; // apilar: la primera hoja debe estar arriba

      const sheet = document.createElement('div');
      sheet.className = 'sheet';
      sheet.style.zIndex = z;

      const front = document.createElement('div');
      front.className = 'face front';
      const imgF = document.createElement('img');
      imgF.alt = `Página ${pageR}`;
      imgF.src = IMAGES[pageR-1] || '';
      front.appendChild(imgF);

      const back = document.createElement('div');
      back.className = 'face back';
      const imgB = document.createElement('img');
      imgB.alt = `Página ${pageL}`;
      imgB.src = IMAGES[pageL-1] || '';
      back.appendChild(imgB);

      sheet.appendChild(front);
      sheet.appendChild(back);

      // efectos hover en desktop
      sheet.addEventListener('pointerenter', ()=>{ if(!sheet.classList.contains('flipped')) sheet.classList.add('hover') });
      sheet.addEventListener('pointerleave', ()=> sheet.classList.remove('hover'));

      book.appendChild(sheet);
      sheets.push(sheet);
    }

    // Estado inicial: ninguna hoja volteada
    sheets.forEach(sh => sh.classList.remove('flipped','hover'));
  }

  function updateUI(){
    // bloquea botones en extremos
    btnPrev.disabled = (currentPage <= 1);
    btnNext.disabled = (currentPage >= N);
    currentEl.textContent = String(currentPage);
    range.value = String(currentPage);

    // calcula cuántas hojas deben estar volteadas para que se vea la página actual
    // Si currentPage es par, mostrará back de la hoja floor(page/2)
    // Si es impar (>1), mostrará front de la hoja (page-1)/2 + las anteriores volteadas
    const needFlipped = Math.floor((currentPage - 1) / 2); // número de hojas vuelta completa

    sheets.forEach((sh, idx) => {
      if (idx < needFlipped) sh.classList.add('flipped'); else sh.classList.remove('flipped');
    });

    // Actualiza hash para deep-link
    const newHash = `#p=${currentPage}`;
    if (location.hash !== newHash) history.replaceState(null, '', newHash);
  }

  function next(){ if (currentPage < N){ currentPage++; updateUI(); }}
  function prev(){ if (currentPage > 1){ currentPage--; updateUI(); }}
  function goTo(p, {instant=false}={}){
    currentPage = Math.min(Math.max(1, p), N);
    if (instant){
      // salta sin animación momentánea
      sheets.forEach(sh => sh.style.transition = 'none');
      updateUI();
      requestAnimationFrame(()=> sheets.forEach(sh => sh.style.transition = ''));
    }else updateUI();
  }

  btnNext.addEventListener('click', next);
  btnPrev.addEventListener('click', prev);
  tapRight.addEventListener('click', next);
  tapLeft.addEventListener('click', prev);
  range.addEventListener('input', e => goTo(Number(e.target.value)));

  // Teclado
  window.addEventListener('keydown', e => {
    if (e.key === 'ArrowRight') next();
    if (e.key === 'ArrowLeft') prev();
    if (e.key === 'Home') goTo(1);
    if (e.key === 'End') goTo(N);
  });

  // Gestos táctiles
  let startX=0, startY=0, dragging=false;
  const gestureArea = book;
  gestureArea.addEventListener('touchstart', e=>{ if(!e.touches[0]) return; dragging=true; startX=e.touches[0].clientX; startY=e.touches[0].clientY; }, {passive:true});
  gestureArea.addEventListener('touchend', e=>{ if(!dragging) return; dragging=false; const t=e.changedTouches[0]; const dx=t.clientX-startX; const dy=t.clientY-startY; if (Math.abs(dx)>40 && Math.abs(dy)<80){ if(dx<0) next(); else prev(); } }, {passive:true});

  // Click en hoja superior: también avanza
  book.addEventListener('click', e=>{
    const topSheet = sheets.find(sh => !sh.classList.contains('flipped'));
    if (!topSheet) return;
    if (topSheet.contains(e.target)) next();
  });

  // Mejora accesible: anunciar página con title
  const observer = new MutationObserver(()=>{ document.title = `Flipbook — pág. ${currentPage}/${N}`; });
  observer.observe(currentEl, {childList:true});

  </script>
</body>
</html>
